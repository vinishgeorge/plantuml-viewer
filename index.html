<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PlantUML Renderer</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    textarea { width: 100%; height: 200px; font-family: monospace; }
    img { margin-top: 1em; border: 1px solid #ccc; }
    .links { margin-top: 1em; }
  </style>
</head>
<body>

<h1>üåø PlantUML Diagram Renderer</h1>
<p>Paste your PlantUML code below or use a link with <code>?code=</code> in the URL to auto-render.</p>

<textarea id="umlInput"></textarea>
<br>
<button onclick="renderDiagram()">Render Diagram</button>

<div id="output"></div>

<script src="https://unpkg.com/plantuml-encoder/dist/plantuml-encoder.min.js"></script>
<script>
  function getCodeFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get('code') ? decodeURIComponent(params.get('code')) : '';
  }

  function renderDiagram() {
    const input = document.getElementById('umlInput').value;
    const encoded = plantumlEncoder.encode(input);
    const baseUrl = 'https://www.plantuml.com/plantuml';

    const formats = ['png', 'svg', 'txt'];

    let html = `<h2>üì∑ Preview</h2>`;
    html += `<img src="${baseUrl}/png/${encoded}" alt="UML Diagram" />`;

    html += `<div class="links"><h3>‚¨áÔ∏è Download / Export</h3><ul>`;
    formats.forEach(format => {
      html += `<li><a href="${baseUrl}/${format}/${encoded}" target="_blank">Download ${format.toUpperCase()}</a></li>`;
    });
    html += `</ul></div>`;

    document.getElementById('output').innerHTML = html;
  }

  // Auto-load code from URL if present
  const autoCode = getCodeFromURL();
  if (autoCode) {
    document.getElementById('umlInput').value = autoCode;
    renderDiagram();
  }
</script>

</body>
</html>
